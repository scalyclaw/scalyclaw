# Plan: Agent Tools, MCPs, and Skills Configuration

## What Changes

Add `tools` and `mcps` fields to agents so each agent can be configured with:
- **model**: Already works (multi-model with weights, "auto" supported). No change needed.
- **tools**: Which direct tools the agent can use (from all available direct tools). Default: current operational subset.
- **skills**: Which skills the agent can invoke. Already exists but needs `mcps` parity.
- **mcps**: Which MCP server IDs the agent can access (their tools get included). Default: none.

## Current State

- Agent config: `{ id, enabled, maxIterations, models, skills }`
- Agent tools: **hardcoded** to `AGENT_DIRECT_NAMES` + `AGENT_JOB_NAMES` in `tools.ts`
- MCP tools: **not available** to agents at all
- Skills: works but no MCP parity

## Design

### New fields on agent config/definition

```typescript
// config.ts — agent entry in orchestrator.agents[]
{ id, enabled, maxIterations, models, skills, tools, mcps }

// agent-loader.ts — AgentDefinition
{ id, name, description, maxIterations, models, skills, tools, mcps, systemPrompt }
```

- `tools: string[]` — direct tool names the agent can use. Empty array = all operational tools (current default behavior).
- `mcps: string[]` — MCP server IDs whose tools are included. Empty array = no MCP tools.

### Changes per file

#### 1. `scalyclaw/src/core/config.ts`
- Add `tools: string[]` and `mcps: string[]` to the agent entry type in `ScalyClawConfig.orchestrator.agents`
- Default: `tools: [], mcps: []`

#### 2. `scalyclaw/src/agents/agent-loader.ts`
- Add `tools: string[]` and `mcps: string[]` to `AgentDefinition`
- Thread through `createAgent()`, `updateAgent()`, `loadAgentFromDir()`, `loadAllAgents()`

#### 3. `scalyclaw/src/tools/tools.ts`
- Change `buildAgentToolDefs(allowedSkillIds)` signature to `buildAgentToolDefs(opts: { skills, tools, mcps })`
- If `opts.tools` is empty, use current `AGENT_DIRECT_NAMES` default set
- If `opts.tools` is non-empty, filter `DIRECT_TOOL_DEFS` to only those names
- If `opts.mcps` is non-empty, call `getMcpToolsForServers(opts.mcps)` and include those MCP tools
- Export `AGENT_DIRECT_NAMES` so the dashboard can show the default list

#### 4. `scalyclaw/src/mcp/mcp-manager.ts`
- Add `getMcpToolsForServers(serverIds: string[]): ToolDefinition[]` — returns tools from only the specified servers

#### 5. `scalyclaw/src/processors/agent-processor.ts`
- Pass `agent.tools` and `agent.mcps` to `buildAgentToolDefs()`
- MCP tools get included in agent's tool list based on `agent.mcps`

#### 6. `scalyclaw/src/api/agents.ts`
- Accept `tools` and `mcps` in POST/PUT body
- Return `tools` and `mcps` in GET responses
- Add `GET /api/agents/tool-options` endpoint — returns available direct tool names + MCP server IDs for the dashboard

#### 7. `scalyclaw/src/tools/tool-impl.ts`
- Update `handleCreateAgent()` and `handleUpdateAgent()` to pass `tools` and `mcps`
- Update tool definitions for `create_agent`, `update_agent` to include `tools` and `mcps` params
- Remove `set_agent_models` and `set_agent_skills` tools (superseded by `update_agent` which handles everything)

#### 8. `dashboard/src/lib/api.ts`
- Add `getAgentToolOptions()` API call

#### 9. `dashboard/src/pages/Agents.tsx`
- Add `tools` and `mcps` to `AgentForm`
- Add MultiSelect for tools (populated from `getAgentToolOptions`)
- Add MultiSelect for MCPs (populated from `getAgentToolOptions`)
- Wire through to create/update payloads

## Files Modified (9)

| File | Changes |
|------|---------|
| `scalyclaw/src/core/config.ts` | Add `tools`, `mcps` to agent config type |
| `scalyclaw/src/agents/agent-loader.ts` | Add fields to AgentDefinition, thread through CRUD |
| `scalyclaw/src/tools/tools.ts` | Parameterize `buildAgentToolDefs`, export defaults |
| `scalyclaw/src/mcp/mcp-manager.ts` | Add `getMcpToolsForServers()` |
| `scalyclaw/src/processors/agent-processor.ts` | Pass tools/mcps to buildAgentToolDefs |
| `scalyclaw/src/api/agents.ts` | Accept/return tools/mcps, add tool-options endpoint |
| `scalyclaw/src/tools/tool-impl.ts` | Update create/update handlers, remove set_agent_models/set_agent_skills |
| `dashboard/src/lib/api.ts` | Add getAgentToolOptions |
| `dashboard/src/pages/Agents.tsx` | Add tools/mcps selectors |

## Verification

1. `bun run build` — zero errors
2. Dashboard: create agent with specific tools + MCPs → verify they show in list
3. Agent execution: verify agent only sees configured tools + MCP tools
